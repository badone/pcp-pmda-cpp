language: cpp

compiler:
  - clang
  - gcc

before_install:
  - sudo apt-get update -qq

install:
  - >
    sudo apt-get install -qq
    libboost-program-options-dev
    libpcp3 libpcp3-dev libpcp-pmda3 libpcp-pmda3-dev
  - sudo pip install cpp-coveralls --use-mirrors

before_script:
  - mkdir -p build

script:
  - pushd build
  - cmake .. && make check
  - popd

after_success:
  #- if [ "$CXX" = "g++" ]; then coveralls -e example -E '.+build/(CMakeFiles|extern)/.*' -E '.+test.*\.cpp'; fi
  - if [ "$CXX" = "g++" ]; then coveralls -e metric_description.hpp -e example -E '.+build/(CMakeFiles|extern)/.*' -E '.+test.*\.cpp' --verbose | tr ',' '\n' | grep "'name':" | sort; fi
  - if [ "$CXX" = "g++" ]; then coveralls -e units.hpp              -e example -E '.+build/(CMakeFiles|extern)/.*' -E '.+test.*\.cpp' --verbose | tr ',' '\n' | grep "'name':" | sort; fi
